<section class="reservation-container">
  <h2 class="reservation-heading">Reservations</h2>

  <!-- Top Bar for About + Add -->
  <div class="top-bar">
    <button class="about-button" routerLink="/about-us">About Us</button>
    <button class="add-reservation-btn" [routerLink]="['/add-reservation']">+ Add Reservation</button>
  </div>

  <!-- Filter Bar -->
  <div class="filter-wrapper">
    <label for="filterArea" class="filter-label">Filter by Area:</label>
    <select id="filterArea" [(ngModel)]="filterArea" class="filter-select">
      <option value="">All Areas</option>
      <option *ngFor="let area of areas" [value]="area">{{ area }}</option>
    </select>
  </div>

  <div class="table-wrapper">
    <table class="reservation-table">
      <thead>
        <tr>
          <th>Conservation Area</th>
          <th>Date</th>
          <th>Time</th>
          <th>Spots Booked</th>
          <th>Total Spots</th>
          <th>Available Spots</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let reservation of filteredReservations">
          <tr class="group-row">
            <td>{{ reservation.conservationAreaName }}</td>
            <td>{{ reservation.reservationDate }}</td>
            <td>{{ reservation.reservationTime }}</td>
            <td>{{ reservation.total_booked }}</td>
            <td>{{ reservation.total_spots }}</td>
            <td>{{ reservation.total_spots - reservation.total_booked }}</td>
          </tr>

          <tr>
            <td colspan="6" class="customer-details">
              <strong>Customers:</strong>
              <ul>
                <li *ngFor="let customer of reservation.customers" class="customer-row">
                  <img class="customer-photo" [src]="getImageSrc(customer.imageFileName)" (error)="onImageError($event)" alt="{{ customer.customerName }}" />
                  <span>{{ customer.customerName }} - {{ customer.spots_booked }} spots</span>
                  <div class="action-buttons">
                    <button class="update-btn" [routerLink]="['/update-reservation', customer.ID]">Update</button>
                    <button class="cancel-btn" (click)="openConfirm(customer.ID)">Cancel</button>
                  </div>
                </li>
              </ul>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>

  <!-- Cancel Modal -->
  <div *ngIf="showConfirm" class="custom-modal">
    <div class="modern-modal-box">
      <div class="modern-modal-header">
        <div class="modern-modal-icon">⚠️</div>
        <h3>Confirm Cancellation</h3>
      </div>
      <p>Are you sure you want to cancel this customer’s reservation?</p>
      <div class="modern-modal-buttons">
        <button class="modern-confirm-btn" (click)="confirmCancel()">Yes, Cancel</button>
        <button class="modern-cancel-btn" (click)="cancelConfirm()">No, Keep It</button>
      </div>
    </div>
  </div>
</section>

<div *ngIf="showConfirm" class="confirm-overlay">
  <div class="confirm-modal">
    <h3 class="modal-title">Cancel Reservation</h3>
    <p class="modal-message">Are you sure you want to cancel this reservation?</p>
    <div class="modal-actions">
      <button class="btn btn-cancel" (click)="cancelConfirm()">No</button>
      <button class="btn btn-confirm" (click)="confirmCancel()">Yes, Cancel</button>
    </div>
  </div>
</div>
