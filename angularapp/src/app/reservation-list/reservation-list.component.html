<section class="reservation-container">
  <h2 class="reservation-heading">Reservations</h2>

  <!-- ✅ Filter Bar -->
  <div class="filter-wrapper">
    <label for="filterArea" class="filter-label">Filter by Area:</label>
    <select id="filterArea" [(ngModel)]="filterArea" class="filter-select">
      <option value="">All Areas</option>
      <option *ngFor="let area of areas" [value]="area">{{ area }}</option>
    </select>
  </div>

  <div class="table-wrapper">
    <table class="reservation-table">
      <thead>
        <tr>
          <th>Conservation Area</th>
          <th>Date</th>
          <th>Time</th>
          <th>Spots Booked</th>
          <th>Total Spots</th>
          <th>Available Spots</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let reservation of filteredReservations">
          <!-- ✅ Group row -->
          <tr class="group-row">
            <td>{{ reservation.conservationAreaName }}</td>
            <td>{{ reservation.reservationDate }}</td>
            <td>{{ reservation.reservationTime }}</td>
            <td>{{ reservation.total_booked }}</td>
            <td>{{ reservation.total_spots }}</td>
            <td>{{ reservation.total_spots - reservation.total_booked }}</td>
          </tr>

          <!-- ✅ Customers -->
          <tr>
            <td colspan="6" class="customer-details">
              <strong>Customers:</strong>
              <ul>
                <li *ngFor="let customer of reservation.customers" class="customer-row">
                  <img
                    class="customer-photo"
                    [src]="
                      customer.imageFileName && customer.imageFileName.trim() !== ''
                        ? 'http://localhost/AngularApp2/angularapp_api/uploads/' + customer.imageFileName.trim()
                        : 'assets/images/placeholder.png'
                    "
                    alt="{{ customer.customerName }}"
                  />

                  <span>{{ customer.customerName }} - {{ customer.spots_booked }} spots</span>

                  <div class="action-buttons">
                    <button class="update-btn" (click)="openUpdateCustomer(customer)">Update</button>
                    <button class="cancel-btn" (click)="openConfirmCustomer(customer.ID)">Cancel</button>
                  </div>
                </li>
              </ul>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>

  <!-- ✅ Cancel modal -->
  <div *ngIf="showConfirm" class="custom-modal">
    <div class="modern-modal-box">
      <div class="modern-modal-header">
        <div class="modern-modal-icon">⚠️</div>
        <h3>Confirm Cancellation</h3>
      </div>
      <p>Are you sure you want to cancel this customer’s reservation?</p>
      <div class="modern-modal-buttons">
        <button class="modern-confirm-btn" (click)="confirmCancel()">Yes, Cancel</button>
        <button class="modern-cancel-btn" (click)="cancelConfirm()">No, Keep It</button>
      </div>
    </div>
  </div>

  <!-- ✅ Update modal -->
  <div *ngIf="showUpdate" class="custom-modal">
    <div class="modern-modal-box">
      <div class="modern-modal-header">
        <div class="modern-modal-icon">✏️</div>
        <h3>Update Reservation</h3>
      </div>
      <form (ngSubmit)="confirmUpdate()">
        <div class="form-group">
          <label>Customer Name</label>
          <input type="text" [(ngModel)]="editCustomer.customerName" name="customerName" required />
        </div>
        <div class="form-group">
          <label>Conservation Area</label>
          <input type="text" [(ngModel)]="editCustomer.conservationAreaName" name="conservationAreaName" required />
        </div>
        <div class="form-group">
          <label>Date</label>
          <input type="date" [(ngModel)]="editCustomer.reservationDate" name="reservationDate" required />
        </div>
        <div class="form-group">
          <label>Time</label>
          <input type="time" [(ngModel)]="editCustomer.reservationTime" name="reservationTime" required />
        </div>
        <div class="form-group">
          <label>Party Size</label>
          <input type="number" [(ngModel)]="editCustomer.partySize" name="partySize" min="1" required />
        </div>
        <div class="modern-modal-buttons">
          <button type="submit" class="modern-confirm-btn">Update</button>
          <button type="button" class="modern-cancel-btn" (click)="cancelUpdate()">Close</button>
        </div>
      </form>
    </div>
  </div>
</section>
